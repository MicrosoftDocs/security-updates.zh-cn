---
TOCTitle: 系统恢复准备
Title: 系统恢复准备
ms:assetid: '885c047f-1e3b-4bf5-8248-3a4505759cbb'
ms:contentKeyID: 18112658
ms:mtpsurl: 'https://technet.microsoft.com/zh-cn/library/Cc747659(v=WS.10)'
---

系统恢复准备
============

RMS 系统任何组件的故障，包括 RMS 服务器、RMS 认证服务器、通过注册子过程注册的 RMS 授权服务器，或安装了 RMS 配置数据库的数据库服务器所使用的 Internet 和 Intranet 连接，都会造成服务的意外丢失。设置 RMS 系统时，如果发生了 RMS 服务丢失、且准备尽可能高效地恢复组件，考虑这种情况下对 IT 系统和敏感数据的潜在影响很重要。

存放 RMS 配置数据库的数据库服务器的故障，是防止继续访问受 RMS 保护的信息的因素之一。本部分介绍了准备 RMS 系统恢复时的重要注意事项和因素，如下所示：

-   [Internet 连接](#bkmk_1)
-   [Intranet 连接](#bkmk_2)
-   [认证和授权服务](#bkmk_3)
-   [数据库服务器](#bkmk_4)
-   [Active Directory](#bkmk_5)

 
Internet 连接
-------------

如果使用联机服务器注册，设置过程中 RMS 服务器需要 Internet 连接以获取服务器授权证书 (SLC)，并每年续订一次。一年快到时，认证服务器会通过向系统事件日志输入事件来通知续订证书。事件在 SLC 到期日期的一个月之前（事件 ID 为 16）、一周之前（事件 ID 为 17）以及 SLC 到期日期（事件 ID 为 18）输入日志。RMS 管理网站的 RMS“全局管理”网页也会就 SLC 到期日期接近发出警报。如果使用 Microsoft Operations Manager (MOM) 的 RMS 管理包，则到期事件会触发警报。如果 RMS 服务器上的 Internet 连接不可用，则不能在 RMS 管理网站中使用“**续订**”按钮来续订服务器许可证书，此时必须使用脱机注册过程来请求续订更新的证书。

作为一项最佳实践，在到期日期之前续订 SLC 可避免如果证书到期时 Internet 连接不可用的复杂情况。没有有效的 SLC，RMS 服务器就不能提供 RMS 服务，意味着用户不能发布受 RMS 保护的信息，或获得读取受 RMS 保护的信息所要求的用户许可证和权限帐户证书 (RAC)。以前获得过受 RMS 保护内容的用户许可证和 RAC 的用户可继续访问该信息，直到其许可证或 RAC 到期为止。

 
Intranet 连接
-------------

RMS 使用依靠连接基础结构的客户端-服务器技术。如果 Intranet 网络工作不正常，则 RMS 服务器不能连接到企业内所需要的服务，也不能连接到用户以提供服务。没有 Intranet 连接，则用户不能从 RMS 服务器获得权限帐户证书 (RAC)、客户端许可方证书 (CLC) 以及用户许可证。

作为一项最佳实践，组织应当考虑从远程站点到 RMS 服务器站点的冗余路由结构和故障转移链接。

一旦用户获得了计算机的 CLC，在不能访问 RMS 服务器时，可脱机发布受 RMS 保护的信息。对电子邮箱进行同步时，一些支持 RMS 的电子邮件应用程序配置为自动为相关的受 RMS 保护的电子邮件信息下载用户许可证，使用户可读取受 RMS 保护的电子邮件信息，即使已不能进行 Intranet 连接。

 
认证和授权服务
--------------

RMS 系统很大程度上依赖于 Internet 信息服务 (IIS) 6.0 中的两个虚拟目录、认证和授权服务。用户及其计算机可通过这些服务注册到 RMS 环境，支持 RMS 的应用程序可通过这些服务发布和访问受 RMS 保护的信息。如果这些服务不可用，会拒绝向用户提供服务，直到服务得到恢复。

要为潜在的服务丢失作好准备，可考虑创建认证服务器和通过注册子过程注册的授权服务器群集，使得群集中任何节点的故障都不会影响服务的可用性。

作为一项最佳实践，可在群集中建立盈余容量，使得任何结点上的错误都不会影响整体性能。在安装第一台认证服务器和每一台通过注册子过程注册的授权服务器，或群集中的第一台通过注册子过程注册的授权服务器时，对配置选项和设置时输入的数据进行细致记录。

 
数据库服务器
------------

RMS 系统中最重要的组件是存放配置数据库的数据库服务器。每一台 RMS 服务器或每个服务器群集都使用数据库来存储配置和日志信息。配置信息对 RMS 的操作必不可少。这些数据库拥有服务器许可方证书、已生成的 RMS 策略模板，在 RMS 系统内注册的用户列表，如果 RMS 服务器没有使用硬件安全模块，则这些数据库还可包含 RMS 服务器的私钥和公钥。使用 RMS 数据库的备份，可恢复在新服务器上以前的 RMS，并重新创建 RMS 系统。数据库丢失的影响会有所不同，取决于数据库。以下列表对给定数据库故障的影响进行了说明：

-   **配置数据库**。如果在 RMS 服务器操作过程中该数据库不可用，RMS 服务可继续正常工作，因为 RMS 将所需的信息在本地进行了缓存。但是，如果发生要求 RMS 服务和配置数据库配合的事件，如新用户注册，则 RMS 服务会遇到错误，新用户不能使用受 RMS 保护的内容。如果发生导致 RMS 服务器放弃缓存信息的操作，如重新启动 IIS 服务或安排好的本地缓存的刷新，则 RMS 服务会停止运行。RMS 服务器将不能返回正常服务，直到配置数据库可用。
    如果配置数据库损坏或永久不可用，则 RMS 服务器会停止运行。
-   **目录服务数据库**。存放组名及其成员身份详情（从全局编目服务器获得）的缓存信息。当该表短时间不可用时，RMS 服务中没有明显的冗余。其主要目的是为全局编目服务器设置冗余和减少的服务负载。
-   **日志数据库**。如果在 RMS 服务器上启用了日志数据库，则使用该数据库来存储日志。如果该数据库不可用，则日志条目会在 RMS 服务器上建立消息队列（也称为 MSMQ）服务，并使用所有可用的磁盘空间，除非没有这样配置。

作为一项最佳实践，建立数据库服务器群集以提供主动应急、故障转移保护。此外，定期备份 RMS 认证服务器和群集的数据库，以及授权服务器和群集的数据库。

作为另一项最佳实践，使用事务日志发送作为维护现成的备份数据库的方法。尽管该实践可能会需要其他硬件，可使组织更快地恢复数据库。Microsoft IT 将该方法用于 RMS 配置数据库恢复。为做到这一点，在 RMS 设置过程中选择虚拟 SQL 名称。虚拟 SQL 名称可使用域名系统 (DNS) 映射到真实的 SQL 名称。如果原来的 SQL Server 停止工作，通过更改从原来服务器映射到备份服务器的 DNS 名称，则可轻松地切换到备份 SQL Server。有关该解决方案在 Microsoft 内部实施的详细信息，请参阅 [Microsoft 网站](https://go.microsoft.com/fwlink/?linkid=42070)上的 Microsoft Corporation 案例研究，网址为 https://go.microsoft.com/fwlink/?LinkId=42070。

 
Active Directory
----------------

RMS 依靠 Active Directory 的两个重要服务：用户身份验证和全局编目服务。如果 Active Directory 不可用，则不能进行用户身份验证，用户及其计算机不能在 RMS 系统中注册。获得 RAC 需要认证管道；该管道要求身份验证。一旦用户拥有了 RAC，则该用户即可获得用户许可证，而不需要进一步的身份验证，因为授权管道默认情况下是匿名的。

由于企业实体可在 Active Directory 中使用组成员身份来表示哪个成员可访问受 RMS 保护的信息，因此 Active Directory 的丢失会禁止用户获取用户许可证。默认情况下，组成员身份信息在 RMS 服务器上的缓存时间为 15 分钟，因此可以允许全局编目服务的临时丢失。如果想增加或减少缓存更新的时间间隔，可对控制有效期的注册表项进行修改。有关详细信息，请参阅本文档集“运行 RMS 服务器”中的“修改 Active Directory 缓存设置”。
